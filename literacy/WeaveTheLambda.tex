%% employing the CTeX for better localization
%% `fandol` is also the default font set,
%%   it has trouble in displaying rarely used characters
%% the `ctexbook` documentclass doesn't provide `openany`
\usepackage[heading = true, fontset = macnew]{ctex}
\usepackage{fancyhdr}

%% for wider margin notes
\usepackage[
   a4paper,
   includemp,
   top=3.170cm,
   bottom=2.510cm,
   left=1.6835cm,
   right=0.6cm,
   marginparwidth=36mm,
   marginparsep=4mm
]{geometry}

\newcommand{\defaultPage}{\newgeometry{left=32mm, top=32mm, ignoremp}}
\newcommand{\defaultPageOriginalHeadWidth}{\defaultPage \addtolength{\headwidth}{-\marginparwidth}}
\renewcommand{\preDoc}{\defaultPage}

\pagestyle{fancy}
\addtolength{\headwidth}{\marginparwidth}

% for typesetting footnote as sidenote
% but why the hell it doesn't work
\usepackage{snotez}

\setsidenotes{
   text-mark-format=\textsuperscript{\normalfont#1},
   note-mark-format={#1:},
   note-mark-sep=\enskip
}

%% for Chinese text
\ctexset{
   chapter/name = {第, 天},
   chapter/number = \chinese{chapter},
   section/name = {第, 幕},
   section/number = \chinese{section},
   section/format = \Large\bfseries,
   subsection/name = {第, 场},
   subsection/number = \chinese{subsection},
   subsubsection/name = {第, 镜},
   subsubsection/number = \chinese{subsubsection}
}

\usepackage{indentfirst}
\setlength{\parindent}{2em}

%% for Advent of Code
\usepackage{tikz}
\usetikzlibrary{decorations.pathmorphing}

\newcommand{\aocPending}[2]{
   \begin{tcolorbox}
   [enhanced, breakable, title={#1},
      attach boxed title to top right={ xshift=-1.618em, yshift=-2mm },
      sharp corners=uphill, arc=2em,
      coltext=Silver, colframe=GhostWhite,
      colback=Black, colbacktitle=MidnightBlue,
      drop fuzzy shadow]
   #2
   \end{tcolorbox}}

\newcommand{\aocStoryTearedPaper}[2]{
   \begin{tcolorbox}
   [enhanced, breakable, frame hidden, title={#1},
      attach boxed title to top right={ xshift=-1.618em, yshift=-2mm },
      boxed title style={ colback=MidnightBlue, drop fuzzy shadow },
      coltext=Silver, colback=Black, colframe=GhostWhite,
      interior style={
         draw=GhostWhite, line width=1pt, color=Black,
         decorate, decoration={ random steps, segment length=3.6mm, amplitude=1.618mm }}]
   #2
   \end{tcolorbox}}

\newenvironment{aocComplain}
{  \begin{tcolorbox}
   [enhanced, breakable, frame hidden,
      interior style={
         draw=GhostWhite, line width=1pt, color=Snow,
         decorate, decoration={ random steps, segment length=4mm, amplitude=2mm }}]}
{  \end{tcolorbox}                                                                 }

\newenvironment{aocBonus}
{  \begin{tcolorbox}
   [enhanced, breakable, frame hidden,
      interior style={
         draw=GhostWhite, line width=1pt, color=Honeydew!32,
         decorate, decoration={ random steps, segment length=4mm, amplitude=2mm }}]}
{  \end{tcolorbox}                                                                 }

\newtcbox{\aocEmph}[1][GhostWhite]{
   on line, nobeforeafter,
   arc=0pt, outer arc=0pt, size=tight,
   coltext=GhostWhite, colframe=#1, colback=Black!64!#1,
   boxsep=1pt, boxrule=0pt }

\newtcbox{\aocQuestion}[1][Gold]{
   on line, nobeforeafter,
   arc=0pt, outer arc=0pt, size=tight,
   coltext=GhostWhite, colframe=#1, colback=Black!75!#1,
   boxsep=0pt, left=1pt, right=1pt, top=2pt, bottom=2pt,
   boxrule=0pt, bottomrule=1pt, toprule=1pt }

% for tags
\newtcbox{\tagBox}[2][]{
   nobeforeafter, on line,
   sharp corners=north, size=title, arc=2mm,
   colframe=#1!85!Black, colback=#1!5!Snow,
   coltext=#2 }
